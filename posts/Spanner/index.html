<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Work In Progress">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="https://blog.yanggliang.cc/posts/Spanner/">
  <meta property="og:site_name" content="Beygl">
  <meta property="og:title" content="Spanner">
  <meta property="og:description" content="Work In Progress">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-11-27T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-04-12T15:27:16+08:00">
    <meta property="article:tag" content="Paper">
    <meta property="article:tag" content="Google">
<title>Spanner | Beygl</title>
<link rel="icon" href="/favicon.ico" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="https://blog.yanggliang.cc/posts/Spanner/">
<link rel="stylesheet" href="/book.min.398b020a1d3522feffe27eafba0f298f8b2abf3126b1f7050cef0418991ae807.css" integrity="sha256-OYsCCh01Iv7/4n6vug8pj4sqvzEmsfcFDO8EGJka6Ac=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.cd68b474856f6dd233ec6892b73f4f3b95960568f63fa9cb25503ff078f4f2a9.js" integrity="sha256-zWi0dIVvbdIz7GiStz9PO5WWBWj2P6nLJVA/8Hj08qk=" crossorigin="anonymous"></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" integrity="sha256-b2&#43;Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC&#43;NdcPIvZhzk=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/yukinonn.jpg" alt="Logo" class="book-icon" /><span>Beygl</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>







  
<ul>
  
  <li>
    <a href="/posts/"  >
        Blog
      </a>
  </li>
  
</ul>










  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>Archive</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-838ff551aadf8defbda918838edd5055" class="toggle"  />
    <label for="section-838ff551aadf8defbda918838edd5055" class="flex justify-between">
      <a role="button" class="">Nihongo</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/archive/Nihongo/39%E8%AA%B2/" class="">39課</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/archive/Nihongo/38%E8%AA%B2/" class="">38課</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/archive/Nihongo/37%E8%AA%B2/" class="">37課</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/archive/Nihongo/36%E8%AA%B2/" class="">36課</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/archive/Nihongo/35%E8%AA%B2/" class="">35課</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>









<ul>
    
    <li>
        <input type="checkbox" id="taxonomy-categories" class="toggle" 
                />
        <label for="taxonomy-categories" class="flex justify-between">
            <a href="/categories" 
               class="">
                Categories
            </a>
        </label>
        <ul>
            
            <li>
                <input type="checkbox" id="term-note" class="toggle" 
                        />
                <label for="term-note" class="flex justify-between">
                    <a href="/categories/note"
                       class="">
                        Note
                    </a>
                </label>
                <ul>
                    
                    <li>
                        <a href="/posts/TaaS/"
                           class="">
                            TaaS
                        </a>
                    </li>
                    
                    <li>
                        <a href="/posts/robinhood/"
                           class="">
                            Robin Hood Hashing
                        </a>
                    </li>
                    
                    <li>
                        <a href="/posts/FalseSharing/"
                           class="">
                            False Sharing
                        </a>
                    </li>
                    
                    <li>
                        <a href="/posts/ConsistentHash/"
                           class="">
                            Consistent Hashing
                        </a>
                    </li>
                    
                    <li>
                        <a href="/posts/TheCongnitiveLoadOfC&#43;&#43;/"
                           class="">
                            The congnitive load of C&#43;&#43;
                        </a>
                    </li>
                    
                    <li>
                        <a href="/posts/Percolator/"
                           class="">
                            Percolator
                        </a>
                    </li>
                    
                    <li>
                        <a href="/posts/Spanner/"
                           class="active">
                            Spanner
                        </a>
                    </li>
                    
                    <li>
                        <a href="/posts/clash/"
                           class="">
                            Clash配置
                        </a>
                    </li>
                    
                </ul>
            </li>
            
            <li>
                <input type="checkbox" id="term-summary" class="toggle" 
                        />
                <label for="term-summary" class="flex justify-between">
                    <a href="/categories/summary"
                       class="">
                        Summary
                    </a>
                </label>
                <ul>
                    
                    <li>
                        <a href="/posts/2024/"
                           class="">
                            2024
                        </a>
                    </li>
                    
                </ul>
            </li>
            
            <li>
                <input type="checkbox" id="term-travel" class="toggle" 
                        />
                <label for="term-travel" class="flex justify-between">
                    <a href="/categories/travel"
                       class="">
                        Travel
                    </a>
                </label>
                <ul>
                    
                    <li>
                        <a href="/posts/japan/"
                           class="">
                            日本旅行
                        </a>
                    </li>
                    
                </ul>
            </li>
            
        </ul>
    </li>
    
    <li>
        <input type="checkbox" id="taxonomy-tags" class="toggle" 
                />
        <label for="taxonomy-tags" class="flex justify-between">
            <a href="/tags" 
               class="">
                Tags
            </a>
        </label>
        <ul>
            
            <li>
                <input type="checkbox" id="term-algorithm" class="toggle" 
                        />
                <label for="term-algorithm" class="flex justify-between">
                    <a href="/tags/algorithm"
                       class="">
                        Algorithm
                    </a>
                </label>
                <ul>
                    
                    <li>
                        <a href="/posts/robinhood/"
                           class="">
                            Robin Hood Hashing
                        </a>
                    </li>
                    
                </ul>
            </li>
            
            <li>
                <input type="checkbox" id="term-cpp" class="toggle" 
                        />
                <label for="term-cpp" class="flex justify-between">
                    <a href="/tags/cpp"
                       class="">
                        Cpp
                    </a>
                </label>
                <ul>
                    
                    <li>
                        <a href="/posts/FalseSharing/"
                           class="">
                            False Sharing
                        </a>
                    </li>
                    
                    <li>
                        <a href="/posts/TheCongnitiveLoadOfC&#43;&#43;/"
                           class="">
                            The congnitive load of C&#43;&#43;
                        </a>
                    </li>
                    
                </ul>
            </li>
            
            <li>
                <input type="checkbox" id="term-gfw" class="toggle" 
                        />
                <label for="term-gfw" class="flex justify-between">
                    <a href="/tags/gfw"
                       class="">
                        Gfw
                    </a>
                </label>
                <ul>
                    
                    <li>
                        <a href="/posts/clash/"
                           class="">
                            Clash配置
                        </a>
                    </li>
                    
                </ul>
            </li>
            
            <li>
                <input type="checkbox" id="term-google" class="toggle" 
                        />
                <label for="term-google" class="flex justify-between">
                    <a href="/tags/google"
                       class="">
                        Google
                    </a>
                </label>
                <ul>
                    
                    <li>
                        <a href="/posts/Percolator/"
                           class="">
                            Percolator
                        </a>
                    </li>
                    
                    <li>
                        <a href="/posts/Spanner/"
                           class="active">
                            Spanner
                        </a>
                    </li>
                    
                </ul>
            </li>
            
            <li>
                <input type="checkbox" id="term-japan" class="toggle" 
                        />
                <label for="term-japan" class="flex justify-between">
                    <a href="/tags/japan"
                       class="">
                        Japan
                    </a>
                </label>
                <ul>
                    
                    <li>
                        <a href="/posts/japan/"
                           class="">
                            日本旅行
                        </a>
                    </li>
                    
                </ul>
            </li>
            
            <li>
                <input type="checkbox" id="term-miscellaneous" class="toggle" 
                        />
                <label for="term-miscellaneous" class="flex justify-between">
                    <a href="/tags/miscellaneous"
                       class="">
                        Miscellaneous
                    </a>
                </label>
                <ul>
                    
                    <li>
                        <a href="/posts/TheCongnitiveLoadOfC&#43;&#43;/"
                           class="">
                            The congnitive load of C&#43;&#43;
                        </a>
                    </li>
                    
                </ul>
            </li>
            
            <li>
                <input type="checkbox" id="term-paper" class="toggle" 
                        />
                <label for="term-paper" class="flex justify-between">
                    <a href="/tags/paper"
                       class="">
                        Paper
                    </a>
                </label>
                <ul>
                    
                    <li>
                        <a href="/posts/TaaS/"
                           class="">
                            TaaS
                        </a>
                    </li>
                    
                    <li>
                        <a href="/posts/ConsistentHash/"
                           class="">
                            Consistent Hashing
                        </a>
                    </li>
                    
                    <li>
                        <a href="/posts/Percolator/"
                           class="">
                            Percolator
                        </a>
                    </li>
                    
                    <li>
                        <a href="/posts/Spanner/"
                           class="active">
                            Spanner
                        </a>
                    </li>
                    
                </ul>
            </li>
            
            <li>
                <input type="checkbox" id="term-vldb" class="toggle" 
                        />
                <label for="term-vldb" class="flex justify-between">
                    <a href="/tags/vldb"
                       class="">
                        Vldb
                    </a>
                </label>
                <ul>
                    
                    <li>
                        <a href="/posts/TaaS/"
                           class="">
                            TaaS
                        </a>
                    </li>
                    
                </ul>
            </li>
            
        </ul>
    </li>
    
</ul>



  
<ul>
  
  <li>
    <a href="https://github.com/yanggl29"  target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop);const n={};document.querySelectorAll(".toggle").forEach(e=>{n[e.id]=e.checked}),localStorage.setItem("menu.expanded",JSON.stringify(n))}),e.scrollTop=localStorage.getItem("menu.scrollTop");const t=JSON.parse(localStorage.getItem("menu.expanded")||"{}");Object.keys(t).forEach(e=>{const n=document.getElementById(e);n&&(n.checked=t[e])})})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>Spanner</h3>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#terminology">Terminology</a></li>
        <li><a href="#whats-special">What&rsquo;s Special</a></li>
        <li><a href="#how-it-works">How it works?</a>
          <ul>
            <li><a href="#structure">Structure</a></li>
            <li><a href="#spanserver">Spanserver</a></li>
          </ul>
        </li>
        <li><a href="#what">What??</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
<article class="markdown book-post">
  <h1>
    Spanner
  </h1>
  
  <div class="flex align-center text-small book-post-date">
    <img src="/svg/calendar.svg" class="book-icon " alt="" />
    <span>November 27, 2023</span>
  </div>


  <div class="book-post-content"><h2 id="terminology">
  Terminology
  <a class="anchor" href="#terminology">#</a>
</h2>
<ul>
<li>External consistency
<ul>
<li>if a transaction 
<link rel="stylesheet" href="/katex/katex.min.css" />
<script defer src="/katex/katex.min.js"></script>
<script defer src="/katex/auto-render.min.js" onload="renderMathInElement(document.body);"></script><span>
  \(T_1\)
</span>
 commits before another transaction <span>
  \(T_2\)
</span>
 starts, then <span>
  \(T_1\)
</span>
’s commit timestamp is smaller than <span>
  \(T_2\)
</span>
’s.</li>
</ul>
</li>
</ul>
<h2 id="whats-special">
  What&rsquo;s Special
  <a class="anchor" href="#whats-special">#</a>
</h2>
<ul>
<li>Cross datacenter.</li>
<li>TrueTime API.</li>
<li>Provides external consistency at global scale.</li>
</ul>
<h2 id="how-it-works">
  How it works?
  <a class="anchor" href="#how-it-works">#</a>
</h2>
<h3 id="structure">
  Structure
  <a class="anchor" href="#structure">#</a>
</h3>
<div class="book-columns flex flex-wrap">
<div class="flex-even markdown-inner" style="flex-grow: 1;">
    
<img src = 'https://cdn.jsdelivr.net/gh/yanggl29/images/content/docs/posts/PaperReading/Spanner/spanner-structure.png'>

  </div>
<div class="flex-even markdown-inner" style="flex-grow: 1;">
    
<img src = 'https://cdn.jsdelivr.net/gh/yanggl29/images/content/docs/posts/PaperReading/Spanner/spanserver.png'>

  </div>

</div>

<ul>
<li>Zone: zone is the rough analog of a deployment of Bigtable servers.</li>
<li>zonemaster: assigns data to spannerserver.</li>
<li>spanserver: serve data to client.</li>
<li>location proxy: client uses it to locate the spannerserver.</li>
<li>universemaster:  a console that displays status information about all the zones for interactive debugging.</li>
<li>placement driver: handles automated movement of data across zones on the timescale of minutes.</li>
</ul>
<h3 id="spanserver">
  Spanserver
  <a class="anchor" href="#spanserver">#</a>
</h3>
<h4 id="transaction">
  Transaction
  <a class="anchor" href="#transaction">#</a>
</h4>
<p>Each transaction will be assigned a timestamp to preserves lineaizability.</p>
<h5 id="read">
  Read
  <a class="anchor" href="#read">#</a>
</h5>
<p>For read-only transaction, Paxos group&rsquo;s leader assigns <span>
  \(s_{read}\)
</span>
. If read happens on single-site, Spanner just assigns <code>LastTS()</code> to <span>
  \(s_{read}\)
</span>
, where <code>LastTS()</code> is the timestamp of the last committed write at a Paxos group. For read happens on multi-Paxos groups, Spanner chose a simple choice. It just has its reads execute at <span>
  \(s_{read} = TT.now().latest\)
</span>
 (which may wait for safe time to advance).</p>
<ul>
<li>What is safe time? - safe time is to preserve lineaizability. A replica can satisfy a read at a timestamp <span>
  \(t\)
</span>
 if <span>
  \(t \le t_{safe}\)
</span>
.</li>
</ul>
<p>Snapshot read is much easier than RO. It can execute at any replicas that are sufficiently up-to-date.</p>
<p>What about Read-Write Transactions?</p>
<h4 id="directory">
  Directory
  <a class="anchor" href="#directory">#</a>
</h4>
<blockquote>
<p>A directory is the unit of data placement, which is a set of contiguous keys that share a common prefix. When data is moved between Paxos groups, it is moved directory by directory. Paxos group consists of tablets. Each spanserver implements a single Paxos state machine on top of each tablet.</p></blockquote>
<ul>
<li>How to move directory? By using Movedir. It will move data in backgroud, and start a transaction to move changed datas.</li>
</ul>
<p>some information:

  <a href="https://www.scs.stanford.edu/17au-cs244b/notes/spanner.txt">https://www.scs.stanford.edu/17au-cs244b/notes/spanner.txt</a>

  <a href="https://quizlet.com/blog/quizlet-cloud-spanner">https://quizlet.com/blog/quizlet-cloud-spanner</a></p>
<h4 id="shortly-of-sstable">
  Shortly of SSTable
  <a class="anchor" href="#shortly-of-sstable">#</a>
</h4>
<blockquote>
<p>It is self-describing and therefore highly redundant, and traversal of individual columns within the same locality group is particularly inefficient.</p></blockquote>
<ul>
<li>Why does traversing the individual columns within the same locality group cause inefficiency?</li>
</ul>
<h2 id="what">
  What??
  <a class="anchor" href="#what">#</a>
</h2>
<blockquote>
<p>In straight-up Paxos, both reads and writes go through same protocol
Leader must wait another round trip to hear from quorum
Why not just handle read locally at the leader (no data to replicate)?
Later leader could have externalized writes, violating linearizability
How do we fix Paxos to handle reads at leader?
Nodes grant leader lease&ndash;promise not to ack other leaders for time T
Given leases from quorum, leader knows no other leaders, can read locally
Assumes bounded clock drift</p></blockquote>
<p>TODO: 
  <a href="https://vldb.org/pvldb/vol15/p3372-pedreira.pdf">https://vldb.org/pvldb/vol15/p3372-pedreira.pdf</a></p>
</div>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

    <section id="comments">
        <script 
            src="https://utteranc.es/client.js"
            repo="yanggl29/images"
            issue-term="title"
            label="comment"
            theme="github-light"
            crossorigin="anonymous"
            async>
        </script>
    </section>
</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#terminology">Terminology</a></li>
        <li><a href="#whats-special">What&rsquo;s Special</a></li>
        <li><a href="#how-it-works">How it works?</a>
          <ul>
            <li><a href="#structure">Structure</a></li>
            <li><a href="#spanserver">Spanserver</a></li>
          </ul>
        </li>
        <li><a href="#what">What??</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












