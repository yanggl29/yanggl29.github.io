<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="
  Consistent Hashing
  #


  Paper Link
  #


  Consistent Hashing and Random Trees: Distributed Caching Protocols for Relieving Hot Spots on the World Wide Web

  Something about hash
  #

Credited to 
  F14.

Some hash functions distribute information evenly across all their bits — any change to the input causes an avalanche of changes to the hash code. Ideally, any one-bit change in the input is expected to change about half the bits of the output. These hash functions can be mapped onto a power-of-two range by just zeroing the top bits. For example, we might map hash codes across 32 chunks by zeroing all but the bottom five bits.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="https://blog.yanggliang.cc/docs/posts/PaperReading/ConsistentHash/">
  <meta property="og:site_name" content="Beygl">
  <meta property="og:title" content="Consistent Hashing">
  <meta property="og:description" content="Consistent Hashing # Paper Link # Consistent Hashing and Random Trees: Distributed Caching Protocols for Relieving Hot Spots on the World Wide Web
Something about hash # Credited to F14.
Some hash functions distribute information evenly across all their bits — any change to the input causes an avalanche of changes to the hash code. Ideally, any one-bit change in the input is expected to change about half the bits of the output. These hash functions can be mapped onto a power-of-two range by just zeroing the top bits. For example, we might map hash codes across 32 chunks by zeroing all but the bottom five bits.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="website">
<title>Consistent Hashing | Beygl</title>
<link rel="icon" href="/favicon.ico" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="https://blog.yanggliang.cc/docs/posts/PaperReading/ConsistentHash/">
<link rel="stylesheet" href="/book.min.3b63b9ecb24b01f1be0df5c6f361b3a2004ab96665227385e0196f67e7607b29.css" integrity="sha256-O2O57LJLAfG&#43;DfXG82GzogBKuWZlInOF4BlvZ&#43;dgeyk=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.2d2f2bb8dc0ba6944c018511c02649029e113cb56e06a51e5234c0df7e5d799c.js" integrity="sha256-LS8ruNwLppRMAYURwCZJAp4RPLVuBqUeUjTA335deZw=" crossorigin="anonymous"></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" integrity="sha256-b2&#43;Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC&#43;NdcPIvZhzk=" crossorigin="anonymous"></script>
<link rel="alternate" type="application/rss+xml" href="https://blog.yanggliang.cc/docs/posts/PaperReading/ConsistentHash/index.xml" title="Beygl" />
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/yukinonn.jpg" alt="Logo" class="book-icon" /><span>Beygl</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>















  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>Posts</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-7ba24779ac7e8304fa1a0c79b2418d53" class="toggle"  />
    <label for="section-7ba24779ac7e8304fa1a0c79b2418d53" class="flex justify-between">
      <a role="button" class="">Linux</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/posts/Linux/clash/" class="">Clash配置</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c92138c0d43e70160be805da1bae8e02" class="toggle"  />
    <label for="section-c92138c0d43e70160be805da1bae8e02" class="flex justify-between">
      <a role="button" class="">Miscellaneous</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-b2ac6864e1a7fea78fc13f670cfb03ba" class="toggle"  />
    <label for="section-b2ac6864e1a7fea78fc13f670cfb03ba" class="flex justify-between">
      <a role="button" class="">Nihongo</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/posts/Nihongo/39%E8%AA%B2/" class="">39課</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/posts/Nihongo/38%E8%AA%B2/" class="">38課</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/posts/Nihongo/37%E8%AA%B2/" class="">37課</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/posts/Nihongo/36%E8%AA%B2/" class="">36課</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/posts/Nihongo/35%E8%AA%B2/" class="">35課</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-cc6256aefc944015381861f0084b088a" class="toggle"  />
    <label for="section-cc6256aefc944015381861f0084b088a" class="flex justify-between">
      <a role="button" class="">Notes</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-edb23d62c3849725d8b8bcda4e833149" class="toggle"  />
    <label for="section-edb23d62c3849725d8b8bcda4e833149" class="flex justify-between">
      <a role="button" class="">Algorithm</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/posts/Notes/Algorithm/RobinHoodHash/" class="">RobinHoodHash</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-2e19460610d221645c5d08f331872344" class="toggle"  />
    <label for="section-2e19460610d221645c5d08f331872344" class="flex justify-between">
      <a role="button" class="">Cpp</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/posts/Notes/CPP/FalseSharing/" class="">False Sharing</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/posts/Notes/CPP/congnitive_load/" class="">The congnitive load of C&#43;&#43;</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-7503cc9b9f6231cc42bbbfd131898ca6" class="toggle" checked />
    <label for="section-7503cc9b9f6231cc42bbbfd131898ca6" class="flex justify-between">
      <a role="button" class="">Paper Reading</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/posts/PaperReading/ConsistentHash/" class="active">Consistent Hashing</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/posts/PaperReading/Percolator/" class="">Percolator</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/posts/PaperReading/Spanner/" class="">Spanner</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-bdb1338a5fbec822432155f1fbf3fdb1" class="toggle"  />
    <label for="section-bdb1338a5fbec822432155f1fbf3fdb1" class="flex justify-between">
      <a role="button" class="">Summary</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/posts/Summary/2024/" class="">2024</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-6e326359b0a8c3ea44d92daa65cafe0e" class="toggle"  />
    <label for="section-6e326359b0a8c3ea44d92daa65cafe0e" class="flex justify-between">
      <a role="button" class="">Travel</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/posts/Travel/Japan/" class="">Japan</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>










  
<ul>
  
  <li>
    <a href="https://github.com/yanggl29"  target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Consistent Hashing</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#consistent-hashing">Consistent Hashing</a>
      <ul>
        <li><a href="#paper-link">Paper Link</a></li>
        <li><a href="#something-about-hash">Something about hash</a></li>
        <li><a href="#introduction">Introduction</a></li>
        <li><a href="#definitions">Definitions</a></li>
        <li><a href="#implementation">Implementation</a></li>
        <li><a href="#thoughts">Thoughts</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="consistent-hashing">
  Consistent Hashing
  <a class="anchor" href="#consistent-hashing">#</a>
</h1>
<h2 id="paper-link">
  Paper Link
  <a class="anchor" href="#paper-link">#</a>
</h2>
<p>
  <a href="https://www.cs.princeton.edu/courses/archive/fall09/cos518/papers/chash.pdf">Consistent Hashing and Random Trees: Distributed Caching Protocols for Relieving Hot Spots on the World Wide Web</a></p>
<h2 id="something-about-hash">
  Something about hash
  <a class="anchor" href="#something-about-hash">#</a>
</h2>
<p>Credited to 
  <a href="https://engineering.fb.com/2019/04/25/developer-tools/f14/">F14</a>.</p>
<blockquote>
<p>Some hash functions distribute information evenly across all their bits — any change to the input causes an avalanche of changes to the hash code. Ideally, any one-bit change in the input is expected to change about half the bits of the output. These hash functions can be mapped onto a power-of-two range by just zeroing the top bits. For example, we might map hash codes across 32 chunks by zeroing all but the bottom five bits.</p></blockquote>
<blockquote>
<p>At the other end of the spectrum are hash functions like std::hash for integral types, which is often the identity function. It meets the C++ standard’s requirements for hash quality (hash codes are very unlikely to be equal unless the inputs are also equal), but it doesn’t spread information at all. If we just took the bottom five bits, for example, then we would experience a large number of collisions if all the integer keys were multiples of 32. If the hash function doesn’t distribute information, then F14 must postprocess the hash code with a bit mixer.</p></blockquote>
<h2 id="introduction">
  Introduction
  <a class="anchor" href="#introduction">#</a>
</h2>
<p>The 
  <a href="https://www.cs.princeton.edu/courses/archive/fall09/cos518/papers/chash.pdf">paper</a> contains a lot of mathematics, but we try to focus on definition and implementation of the consistent hashing. We will skip the mathematical details and theorem proofs, and only concentrate on the core contributions of the paper.</p>
<h2 id="definitions">
  Definitions
  <a class="anchor" href="#definitions">#</a>
</h2>
<ul>
<li>Balance: literally balance, meaning that hash function could generate a hash code with an even distribtion.</li>
<li>Monotonicity: this property says that if items are initially assigned to a set of buckets 
<link rel="stylesheet" href="/katex/katex.min.css" />
<script defer src="/katex/katex.min.js"></script>
<script defer src="/katex/auto-render.min.js" onload="renderMathInElement(document.body);"></script><span>
  \(\mathcal{V}_1\)
</span>
 and then some new buckets are added to form <span>
  \(\mathcal{V}_2\)
</span>
 , then an item may move from an old bucket to a new bucket, but not from one old bucket to another old bucket.</li>
<li>Spread: For example, there is a set of clients, and each clients may have different sight of servers. The spread means the same item will be assigned to a same server with high probability.</li>
<li>Load: The load property is similar to spread. It just explain the same thing from a different side.</li>
</ul>
<h2 id="implementation">
  Implementation
  <a class="anchor" href="#implementation">#</a>
</h2>
<p>Implementation is simple, proofs are hard. If you want to learn about the proofs, you should read the 
  <a href="https://www.cs.princeton.edu/courses/archive/fall09/cos518/papers/chash.pdf">paper</a>. Let&rsquo;s get into the implementation here.</p>
<p>Let&rsquo;s say we have two functions <span>
  \(\mathcal{r}_\mathcal{I}\)
</span>
 and <span>
  \(\mathcal{r}_\mathcal{B}\)
</span>
 (we often use MurmurHash in the industry). The function <span>
  \(\mathcal{r}_\mathcal{B}\)
</span>
 maps buckets randomly to the unit interval, and <span>
  \(\mathcal{r}_\mathcal{I}\)
</span>
 does the same for items. The consistent hashing is defined to be the function which maps the item <span>
  \(i\)
</span>
 to the bucket “closest” to <span>
  \(i\)
</span>
. In the industry, we usually map the same bucket to multi-nodes by concatenating a suffix to the bucket.</p>
<h2 id="thoughts">
  Thoughts
  <a class="anchor" href="#thoughts">#</a>
</h2>
<ul>
<li>What is the most innovative part of consistent hashing?
<ul>
<li>I would say the main idea of the consistent hashing is to use mapping functions to map both bucket and item to the unit interval. This approach ensures that when the buckets changes, most items will not move to the changed bucket.</li>
</ul>
</li>
<li>Can we make any improvements on consistent hashing?
<ul>
<li>Yes, Google has proposed a 
  <a href="https://arxiv.org/abs/1406.2294">paper</a>(jump consistent hash) which optimizes the performance for lookups.</li>
</ul>
</li>
</ul>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

    <section id="comments">
        <script 
            src="https://utteranc.es/client.js"
            repo="yanggl29/images"
            issue-term="title"
            label="comment"
            theme="github-light"
            crossorigin="anonymous"
            async>
        </script>
    </section>
</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#consistent-hashing">Consistent Hashing</a>
      <ul>
        <li><a href="#paper-link">Paper Link</a></li>
        <li><a href="#something-about-hash">Something about hash</a></li>
        <li><a href="#introduction">Introduction</a></li>
        <li><a href="#definitions">Definitions</a></li>
        <li><a href="#implementation">Implementation</a></li>
        <li><a href="#thoughts">Thoughts</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












